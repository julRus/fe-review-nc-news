{"ast":null,"code":"import _toConsumableArray from\"/home/julia/northcoders/FRONTEND/fe-review-nc-news/nc-news/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"/home/julia/northcoders/FRONTEND/fe-review-nc-news/nc-news/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/home/julia/northcoders/FRONTEND/fe-review-nc-news/nc-news/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/julia/northcoders/FRONTEND/fe-review-nc-news/nc-news/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/julia/northcoders/FRONTEND/fe-review-nc-news/nc-news/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/julia/northcoders/FRONTEND/fe-review-nc-news/nc-news/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/julia/northcoders/FRONTEND/fe-review-nc-news/nc-news/node_modules/@babel/runtime/helpers/esm/inherits\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import React from\"react\";import*as api from\"../api\";import Header from\"./Header\";import CommentCard from\"./subComponents/CommentCard\";import VotesIncrementer from\"./subComponents/VotesIncrementer\";import ErrorShower from\"../components/ErrorShower\";import CommentMaker from\"./subComponents/CommentMaker\";var Article=/*#__PURE__*/function(_React$Component){_inherits(Article,_React$Component);function Article(){var _getPrototypeOf2;var _this;_classCallCheck(this,Article);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(Article)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={article:{},comments:[],isLoading:true,err:null,voteChangeArticle:0,voteChangeComment:0,hasCommented:false};_this.handleVoteChange=function(id,amnt,value){if(value===\"voteChangeComment\"){_this.setState(function(currentState){var newSate=_objectSpread({},currentState,{comments:_toConsumableArray(currentState.comments)});newSate.comments.map(function(comment){if(id===comment.comment_id){comment.votes+=amnt;}});return newSate;});}else{_this.setState({voteChangeArticle:amnt});}};_this.addComment=function(comment){_this.setState(function(currentState){var newState=_objectSpread({},_this.sate,{comments:_this.state.comments});newState.comments.unshift(comment);return newState;});};return _this;}_createClass(Article,[{key:\"render\",value:function render(){var _this2=this;if(this.state.isLoading)return React.createElement(\"p\",{className:\"loadIndicator\"},\"Loading...\");if(this.state.err!==null)return React.createElement(ErrorShower,{err:this.state.err});var _this$state$article=this.state.article,title=_this$state$article.title,created_at=_this$state$article.created_at,author=_this$state$article.author,votes=_this$state$article.votes,body=_this$state$article.body;var comments=this.state.comments;return React.createElement(React.Fragment,null,React.createElement(\"header\",null,\" \",React.createElement(Header,{user:this.props.user})),React.createElement(\"main\",{className:\"article\"},React.createElement(\"div\",null,React.createElement(\"div\",null,React.createElement(\"h4\",{className:\"article_title\"},title),React.createElement(VotesIncrementer,{articleVotes:this.state.article.votes,id:this.state.article.article_id,displayVote:this.handleVoteChange,name:\"articleVoter\"})),React.createElement(\"div\",{className:\"article_header\"},\" \",React.createElement(\"p\",{className:\"article_author\"},author),React.createElement(\"p\",{className:\"article_date\"},created_at),React.createElement(\"p\",{className:\"article_votes\",id:\"voter\"},(votes+this.state.voteChangeArticle).toString())),React.createElement(\"p\",{className:\"article_body\"},body)),React.createElement(\"p\",{className:\"comments_title\"},\"Comments\"),React.createElement(\"div\",null,React.createElement(\"section\",{className:\"comment_form\"},React.createElement(CommentMaker,{user:this.props.user,article_id:this.state.article.article_id,comments:this.state.comments,addComment:this.addComment})),React.createElement(\"ul\",{className:\"comments\"},comments.map(function(comment){return React.createElement(\"div\",{key:comment.comment_id},React.createElement(CommentCard,{key:comment.comment_id,id:comment.comment_id,author:comment.author,body:comment.body,date:comment.created_at,votes:comment.votes}),\" \",React.createElement(\"button\",{style:{display:comment.author===_this2.props.user.username?\"block\":\"none\"},onClick:function onClick(){return _this2.deletionChecker(comment.author,comment.comment_id);}},\"DELETE\"),React.createElement(VotesIncrementer,{commentVotes:comment.votes,commentId:comment.comment_id,displayVote:_this2.handleVoteChange,name:\"comments\"}));})))));}},{key:\"componentDidMount\",value:function componentDidMount(){this.fetchArticle(this.props.article_id);this.fetchComments(this.props.article_id);}},{key:\"fetchArticle\",value:function fetchArticle(id){var _this3=this;api.getArticleById(id).then(function(article){_this3.setState({article:article,isLoading:false});}).catch(function(err){_this3.setState({err:{status:err.response.status,msg:err.response.data.msg,user:_this3.props.user},isLoading:false});});}},{key:\"fetchComments\",value:function fetchComments(id){var _this4=this;api.getArticleComments(id).then(function(comments){_this4.setState({comments:comments,isLoading:false});}).catch(function(err){_this4.setState({err:{status:400,msg:\"cannot get article of id \".concat(id,\", does not exist\"),user:_this4.props.user},isLoading:false});});}},{key:\"deletionChecker\",value:function deletionChecker(author,id){console.log(id);if(author===this.props.user.username){var willDelete=window.confirm(\"Are you sure you want to delete this comment?\");if(willDelete){api.deleteComment(author,id);this.deletedComment(id);}else{alert(\"deletion cancelled\");}}}},{key:\"deletedComment\",value:function deletedComment(id){var _this5=this;this.setState(function(currentState){// const newState = { ...this.sate, comments: this.state.comments };\nvar newState=_this5.state.comments.filter(function(comment){return id!==comment.comment_id;});return{comments:newState};});}}]);return Article;}(React.Component);export{Article as default};","map":{"version":3,"sources":["/home/julia/northcoders/FRONTEND/fe-review-nc-news/nc-news/src/components/Article.jsx"],"names":["React","api","Header","CommentCard","VotesIncrementer","ErrorShower","CommentMaker","Article","state","article","comments","isLoading","err","voteChangeArticle","voteChangeComment","hasCommented","handleVoteChange","id","amnt","value","setState","currentState","newSate","map","comment","comment_id","votes","addComment","newState","sate","unshift","title","created_at","author","body","props","user","article_id","toString","display","username","deletionChecker","fetchArticle","fetchComments","getArticleById","then","catch","status","response","msg","data","getArticleComments","console","log","willDelete","window","confirm","deleteComment","deletedComment","alert","filter","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport * as api from \"../api\";\nimport Header from \"./Header\";\n\nimport CommentCard from \"./subComponents/CommentCard\";\nimport VotesIncrementer from \"./subComponents/VotesIncrementer\";\nimport ErrorShower from \"../components/ErrorShower\";\nimport CommentMaker from \"./subComponents/CommentMaker\";\n\nexport default class Article extends React.Component {\n  state = {\n    article: {},\n    comments: [],\n    isLoading: true,\n    err: null,\n    voteChangeArticle: 0,\n    voteChangeComment: 0,\n    hasCommented: false\n  };\n\n  render() {\n    if (this.state.isLoading)\n      return <p className=\"loadIndicator\">Loading...</p>;\n    if (this.state.err !== null) return <ErrorShower err={this.state.err} />;\n    const { title, created_at, author, votes, body } = this.state.article;\n    const { comments } = this.state;\n    return (\n      <>\n        <header>\n          {\" \"}\n          <Header user={this.props.user} />\n        </header>\n        <main className=\"article\">\n          <div>\n            <div>\n              <h4 className=\"article_title\">{title}</h4>\n              <VotesIncrementer\n                articleVotes={this.state.article.votes}\n                id={this.state.article.article_id}\n                displayVote={this.handleVoteChange}\n                name=\"articleVoter\"\n              />\n            </div>\n\n            <div className=\"article_header\">\n              {\" \"}\n              <p className=\"article_author\">{author}</p>\n              <p className=\"article_date\">{created_at}</p>\n              <p className=\"article_votes\" id=\"voter\">\n                {(votes + this.state.voteChangeArticle).toString()}\n              </p>\n            </div>\n            <p className=\"article_body\">{body}</p>\n          </div>\n          <p className=\"comments_title\">Comments</p>\n          <div>\n            <section className=\"comment_form\">\n              <CommentMaker\n                user={this.props.user}\n                article_id={this.state.article.article_id}\n                comments={this.state.comments}\n                addComment={this.addComment}\n              />\n            </section>\n            <ul className=\"comments\">\n              {comments.map(comment => {\n                return (\n                  <div key={comment.comment_id}>\n                    <CommentCard\n                      key={comment.comment_id}\n                      id={comment.comment_id}\n                      author={comment.author}\n                      body={comment.body}\n                      date={comment.created_at}\n                      votes={comment.votes}\n                    />{\" \"}\n                    <button\n                      style={{\n                        display:\n                          comment.author === this.props.user.username\n                            ? \"block\"\n                            : \"none\"\n                      }}\n                      onClick={() =>\n                        this.deletionChecker(comment.author, comment.comment_id)\n                      }\n                    >\n                      DELETE\n                    </button>\n                    <VotesIncrementer\n                      commentVotes={comment.votes}\n                      commentId={comment.comment_id}\n                      displayVote={this.handleVoteChange}\n                      name=\"comments\"\n                    />\n                  </div>\n                );\n              })}\n            </ul>\n          </div>\n        </main>\n      </>\n    );\n  }\n\n  componentDidMount() {\n    this.fetchArticle(this.props.article_id);\n    this.fetchComments(this.props.article_id);\n  }\n\n  fetchArticle(id) {\n    api\n      .getArticleById(id)\n      .then(article => {\n        this.setState({ article: article, isLoading: false });\n      })\n      .catch(err => {\n        this.setState({\n          err: {\n            status: err.response.status,\n            msg: err.response.data.msg,\n            user: this.props.user\n          },\n          isLoading: false\n        });\n      });\n  }\n\n  fetchComments(id) {\n    api\n      .getArticleComments(id)\n      .then(comments => {\n        this.setState({ comments: comments, isLoading: false });\n      })\n      .catch(err => {\n        this.setState({\n          err: {\n            status: 400,\n            msg: `cannot get article of id ${id}, does not exist`,\n            user: this.props.user\n          },\n          isLoading: false\n        });\n      });\n  }\n\n  handleVoteChange = (id, amnt, value) => {\n    if (value === \"voteChangeComment\") {\n      this.setState(currentState => {\n        const newSate = {\n          ...currentState,\n          comments: [...currentState.comments]\n        };\n        newSate.comments.map(comment => {\n          if (id === comment.comment_id) {\n            comment.votes += amnt;\n          }\n        });\n        return newSate;\n      });\n    } else {\n      this.setState({ voteChangeArticle: amnt });\n    }\n  };\n\n  deletionChecker(author, id) {\n    console.log(id);\n    if (author === this.props.user.username) {\n      const willDelete = window.confirm(\n        \"Are you sure you want to delete this comment?\"\n      );\n      if (willDelete) {\n        api.deleteComment(author, id);\n        this.deletedComment(id);\n      } else {\n        alert(\"deletion cancelled\");\n      }\n    }\n  }\n\n  deletedComment(id) {\n    this.setState(currentState => {\n      // const newState = { ...this.sate, comments: this.state.comments };\n      const newState = this.state.comments.filter(comment => {\n        return id !== comment.comment_id;\n      });\n      return { comments: newState };\n    });\n  }\n\n  addComment = comment => {\n    this.setState(currentState => {\n      const newState = { ...this.sate, comments: this.state.comments };\n      newState.comments.unshift(comment);\n      return newState;\n    });\n  };\n}\n"]},"metadata":{},"sourceType":"module"}